#include "kernel.h"
#include "screen.h"
#include "idt.h"
#include "pic.h"
#include "keyboard.h"
#include "input.h"
#include "timer.h"
#include "bitmap_font.h"
#include "string.h"
#include "debug.h"
#include "io.h"
#include "memory.h"
#include "terminal.h"

const unsigned char (*current_font)[8] = font8x8;
int char_width = 8;
int char_height = 8;

void screen_change_font(const unsigned char font[128][8], int width, int height) {
    current_font = font;
    char_width = width;
    char_height = height;
}

const unsigned char font8x8[128][8] = {
    ['0'] = {0x3C,0x66,0x6E,0x7E,0x76,0x66,0x3C,0x00},
    ['1'] = {0x18,0x38,0x18,0x18,0x18,0x18,0x7E,0x00},
    ['2'] = {0x3C,0x66,0x06,0x0C,0x30,0x60,0x7E,0x00},
    ['3'] = {0x3C,0x66,0x06,0x1C,0x06,0x66,0x3C,0x00},
    ['4'] = {0x0C,0x1C,0x3C,0x6C,0x7E,0x0C,0x0C,0x00},
    ['5'] = {0x7E,0x60,0x7C,0x06,0x06,0x66,0x3C,0x00},
    ['6'] = {0x1C,0x30,0x60,0x7C,0x66,0x66,0x3C,0x00},
    ['7'] = {0x7E,0x66,0x0C,0x18,0x30,0x30,0x30,0x00},
    ['8'] = {0x3C,0x66,0x66,0x3C,0x66,0x66,0x3C,0x00},
    ['9'] = {0x3C,0x66,0x66,0x3E,0x06,0x0C,0x38,0x00},

    ['a'] = {0x00,0x00,0x3C,0x06,0x3E,0x66,0x3E,0x00},
    ['b'] = {0x60,0x60,0x7C,0x66,0x66,0x66,0x7C,0x00},
    ['c'] = {0x00,0x00,0x3C,0x66,0x60,0x66,0x3C,0x00},
    ['d'] = {0x06,0x06,0x3E,0x66,0x66,0x66,0x3E,0x00},
    ['e'] = {0x00,0x00,0x3C,0x66,0x7E,0x60,0x3C,0x00},
    ['f'] = {0x1C,0x36,0x30,0x78,0x30,0x30,0x30,0x00},
    ['g'] = {0x00,0x00,0x3E,0x66,0x66,0x3E,0x06,0x7C},
    ['h'] = {0x60,0x60,0x7C,0x66,0x66,0x66,0x66,0x00},
    ['i'] = {0x18,0x00,0x38,0x18,0x18,0x18,0x3C,0x00},
    ['j'] = {0x0C,0x00,0x0C,0x0C,0x0C,0x6C,0x6C,0x38},
    ['k'] = {0x60,0x60,0x66,0x6C,0x78,0x6C,0x66,0x00},
    ['l'] = {0x38,0x18,0x18,0x18,0x18,0x18,0x3C,0x00},
    ['m'] = {0x00,0x00,0x6C,0x7E,0x6B,0x6B,0x63,0x00},
    ['n'] = {0x00,0x00,0x7C,0x66,0x66,0x66,0x66,0x00},
    ['o'] = {0x00,0x00,0x3C,0x66,0x66,0x66,0x3C,0x00},
    ['p'] = {0x00,0x00,0x7C,0x66,0x66,0x7C,0x60,0x60},
    ['q'] = {0x00,0x00,0x3E,0x66,0x66,0x3E,0x06,0x06},
    ['r'] = {0x00,0x00,0x6C,0x76,0x60,0x60,0x60,0x00},
    ['s'] = {0x00,0x00,0x3E,0x60,0x3C,0x06,0x7C,0x00},
    ['t'] = {0x30,0x30,0x78,0x30,0x30,0x36,0x1C,0x00},
    ['u'] = {0x00,0x00,0x66,0x66,0x66,0x66,0x3E,0x00},
    ['v'] = {0x00,0x00,0x66,0x66,0x66,0x3C,0x18,0x00},
    ['w'] = {0x00,0x00,0x63,0x6B,0x6B,0x7F,0x36,0x00},
    ['x'] = {0x00,0x00,0x66,0x3C,0x18,0x3C,0x66,0x00},
    ['y'] = {0x00,0x00,0x66,0x66,0x3E,0x06,0x0C,0x78},
    ['z'] = {0x00,0x00,0x7E,0x0C,0x18,0x30,0x7E,0x00},

    ['A'] = {0x18,0x24,0x42,0x7E,0x42,0x42,0x42,0x00},
    ['B'] = {0x7C,0x66,0x66,0x7C,0x66,0x66,0x7C,0x00},
    ['C'] = {0x3C,0x66,0x60,0x60,0x60,0x66,0x3C,0x00},
    ['D'] = {0x78,0x6C,0x66,0x66,0x66,0x6C,0x78,0x00},
    ['E'] = {0x7E,0x60,0x60,0x7C,0x60,0x60,0x7E,0x00},
    ['F'] = {0x7E,0x60,0x60,0x7C,0x60,0x60,0x60,0x00},
    ['G'] = {0x3C,0x66,0x60,0x6E,0x66,0x66,0x3E,0x00},
    ['H'] = {0x66,0x66,0x66,0x7E,0x66,0x66,0x66,0x00},
    ['I'] = {0x3C,0x18,0x18,0x18,0x18,0x18,0x3C,0x00},
    ['J'] = {0x1E,0x0C,0x0C,0x0C,0x0C,0x6C,0x38,0x00},
    ['K'] = {0x66,0x6C,0x78,0x70,0x78,0x6C,0x66,0x00},
    ['L'] = {0x60,0x60,0x60,0x60,0x60,0x60,0x7E,0x00},
    ['M'] = {0x63,0x77,0x7F,0x6B,0x63,0x63,0x63,0x00},
    ['N'] = {0x66,0x76,0x7E,0x7E,0x6E,0x66,0x66,0x00},
    ['O'] = {0x3C,0x66,0x66,0x66,0x66,0x66,0x3C,0x00},
    ['P'] = {0x7C,0x66,0x66,0x7C,0x60,0x60,0x60,0x00},
    ['Q'] = {0x3C,0x66,0x66,0x66,0x6E,0x3C,0x0E,0x00},
    ['R'] = {0x7C,0x66,0x66,0x7C,0x78,0x6C,0x66,0x00},
    ['S'] = {0x3C,0x66,0x30,0x18,0x0C,0x66,0x3C,0x00},
    ['T'] = {0x7E,0x5A,0x18,0x18,0x18,0x18,0x3C,0x00},
    ['U'] = {0x66,0x66,0x66,0x66,0x66,0x66,0x3C,0x00},
    ['V'] = {0x66,0x66,0x66,0x66,0x66,0x3C,0x18,0x00},
    ['W'] = {0x63,0x63,0x63,0x6B,0x7F,0x77,0x63,0x00},
    ['X'] = {0x66,0x66,0x3C,0x18,0x3C,0x66,0x66,0x00},
    ['Y'] = {0x66,0x66,0x3C,0x18,0x18,0x18,0x3C,0x00},
    ['Z'] = {0x7E,0x06,0x0C,0x18,0x30,0x60,0x7E,0x00},

    ['.'] = {0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00},
    [','] = {0x00,0x00,0x00,0x00,0x18,0x18,0x30,0x00},
    [':'] = {0x00,0x18,0x18,0x00,0x18,0x18,0x00,0x00},
    [';'] = {0x00,0x18,0x18,0x00,0x18,0x18,0x30,0x00},
    ['!'] = {0x18,0x3C,0x3C,0x18,0x18,0x00,0x18,0x00},
    ['?'] = {0x3C,0x66,0x0C,0x18,0x18,0x00,0x18,0x00},
    ['@'] = {0x3C,0x42,0x5A,0x5A,0x5E,0x40,0x3E,0x00},
    ['#'] = {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00},
    ['$'] = {0x18,0x3E,0x60,0x3C,0x06,0x7C,0x18,0x00},
    ['%'] = {0x62,0x64,0x08,0x10,0x26,0x46,0x00,0x00},
    ['^'] = {0x10,0x28,0x44,0x00,0x00,0x00,0x00,0x00},
    ['&'] = {0x30,0x48,0x30,0x4A,0x44,0x3A,0x00,0x00},
    ['*'] = {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00},
    ['('] = {0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00},
    [')'] = {0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00},
    ['['] = {0x1C,0x18,0x18,0x18,0x18,0x18,0x1C,0x00},
    [']'] = {0x38,0x18,0x18,0x18,0x18,0x18,0x38,0x00},
    ['{'] = {0x0E,0x0C,0x0C,0x38,0x0C,0x0C,0x0E,0x00},
    ['}'] = {0x38,0x18,0x18,0x0E,0x18,0x18,0x38,0x00},
    ['<'] = {0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x00},
    ['>'] = {0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x00},
    ['/'] = {0x06,0x0C,0x18,0x30,0x60,0xC0,0x80,0x00},
    ['\\'] = {0xC0,0x60,0x30,0x18,0x0C,0x06,0x02,0x00},
    ['|'] = {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00},
    ['-'] = {0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00},
    ['_'] = {0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00},
    ['+'] = {0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00},
    ['='] = {0x00,0x7E,0x00,0x7E,0x00,0x00,0x00,0x00},
    ['\''] = {0x18,0x18,0x30,0x00,0x00,0x00,0x00,0x00},
    ['"'] = {0x6C,0x6C,0x48,0x00,0x00,0x00,0x00,0x00},
    ['`'] = {0x30,0x18,0x00,0x00,0x00,0x00,0x00,0x00},
    ['~'] = {0x32,0x4C,0x00,0x00,0x00,0x00,0x00,0x00},
    [' '] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};


const unsigned char font6x6[128][8] = {
    ['0'] = {0x7C,0xCE,0xD6,0xE6,0xCE,0x7C,0x00,0x00},
    ['1'] = {0x18,0x38,0x18,0x18,0x18,0x7E,0x00,0x00},
    ['2'] = {0x7C,0xC6,0x0C,0x38,0x60,0xFE,0x00,0x00},
    ['3'] = {0x7C,0xC6,0x1C,0x06,0xC6,0x7C,0x00,0x00},
    ['4'] = {0x1C,0x3C,0x6C,0xCC,0xFE,0x0C,0x00,0x00},
    ['5'] = {0xFE,0xC0,0xFC,0x06,0xC6,0x7C,0x00,0x00},      
    ['6'] = {0x3C,0x60,0xFC,0xC6,0xC6,0x7C,0x00,0x00},
    ['7'] = {0xFE,0x06,0x0C,0x18,0x30,0x30,0x00,0x00},
    ['8'] = {0x7C,0xC6,0x7C,0xC6,0xC6,0x7C,0x00,0x00},
    ['9'] = {0x7C,0xC6,0xC6,0x7E,0x06,0x3C,0x00,0x00},

    ['a'] = {0x00,0x00,0x7C,0x06,0x7E,0x7E,0x00,0x00},
    ['b'] = {0x60,0x60,0x7C,0x66,0x66,0x7C,0x00,0x00},
    ['c'] = {0x00,0x00,0x7E,0x60,0x60,0x7E,0x00,0x00},
    ['d'] = {0x06,0x06,0x7E,0x66,0x66,0x7E,0x00,0x00},
    ['e'] = {0x00,0x00,0x7C,0x7E,0x60,0x7C,0x00,0x00},
    ['f'] = {0x3C,0x60,0x7C,0x60,0x60,0x60,0x00,0x00},
    ['g'] = {0x00,0x00,0x7E,0x66,0x7E,0x06,0x7C,0x00},
    ['h'] = {0x60,0x60,0x7C,0x66,0x66,0x66,0x00,0x00},
    ['i'] = {0x18,0x00,0x38,0x18,0x18,0x7E,0x00,0x00},
    ['j'] = {0x0C,0x00,0x0C,0x0C,0x0C,0x6C,0x38,0x00},
    ['k'] = {0x60,0x60,0x6C,0x78,0x6C,0x6C,0x00,0x00},
    ['l'] = {0x38,0x18,0x18,0x18,0x18,0x7E,0x00,0x00},
    ['m'] = {0x00,0x00,0x6C,0xFE,0xD6,0xC6,0x00,0x00},
    ['n'] = {0x00,0x00,0x7C,0x66,0x66,0x66,0x00,0x00},
    ['o'] = {0x00,0x00,0x7C,0x66,0x66,0x7C,0x00,0x00},
    ['p'] = {0x00,0x00,0x7C,0x66,0x7C,0x60,0x60,0x00},
    ['q'] = {0x00,0x00,0x7E,0x66,0x7E,0x06,0x06,0x00},
    ['r'] = {0x00,0x00,0x6C,0x70,0x60,0x60,0x00,0x00},
    ['s'] = {0x00,0x00,0x7E,0x78,0x1E,0x7E,0x00,0x00},
    ['t'] = {0x30,0x30,0x7C,0x30,0x30,0x1C,0x00,0x00},
    ['u'] = {0x00,0x00,0x66,0x66,0x66,0x7E,0x00,0x00},
    ['v'] = {0x00,0x00,0x66,0x66,0x6C,0x38,0x00,0x00},
    ['w'] = {0x00,0x00,0xC6,0xD6,0xFE,0x6C,0x00,0x00},
    ['x'] = {0x00,0x00,0x66,0x3C,0x3C,0x66,0x00,0x00},
    ['y'] = {0x00,0x00,0x66,0x66,0x7E,0x06,0x7C,0x00},
    ['z'] = {0x00,0x00,0x7E,0x1C,0x38,0x7E,0x00,0x00},

    ['A'] = {0x7C,0xC6,0xC6,0xFE,0xC6,0xC6,0x00,0x00},
    ['B'] = {0xFC,0xC6,0xFC,0xC6,0xC6,0xFC,0x00,0x00},
    ['C'] = {0x7E,0xC0,0xC0,0xC0,0xC0,0x7E,0x00,0x00},
    ['D'] = {0xFC,0xC6,0xC6,0xC6,0xC6,0xFC,0x00,0x00},
    ['E'] = {0xFE,0xC0,0xFC,0xC0,0xC0,0xFE,0x00,0x00},
    ['F'] = {0xFE,0xC0,0xFC,0xC0,0xC0,0xC0,0x00,0x00},
    ['G'] = {0x7E,0xC0,0xC0,0xCE,0xC6,0x7E,0x00,0x00},
    ['H'] = {0xC6,0xC6,0xFE,0xC6,0xC6,0xC6,0x00,0x00},
    ['I'] = {0x7E,0x18,0x18,0x18,0x18,0x7E,0x00,0x00},
    ['J'] = {0x1E,0x06,0x06,0x06,0xC6,0x7C,0x00,0x00},
    ['K'] = {0xC6,0xCC,0xF8,0xCC,0xC6,0xC6,0x00,0x00},
    ['L'] = {0xC0,0xC0,0xC0,0xC0,0xC0,0xFE,0x00,0x00},
    ['M'] = {0xC6,0xEE,0xFE,0xD6,0xC6,0xC6,0x00,0x00},
    ['N'] = {0xC6,0xE6,0xF6,0xDE,0xCE,0xC6,0x00,0x00},
    ['O'] = {0x7C,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,0x00},
    ['P'] = {0xFC,0xC6,0xC6,0xFC,0xC0,0xC0,0x00,0x00},
    ['Q'] = {0x7C,0xC6,0xC6,0xD6,0xCC,0x7A,0x00,0x00},
    ['R'] = {0xFC,0xC6,0xC6,0xFC,0xCC,0xC6,0x00,0x00},
    ['S'] = {0x7E,0xC0,0x7C,0x06,0x06,0xFC,0x00,0x00},
    ['T'] = {0x7E,0x18,0x18,0x18,0x18,0x18,0x00,0x00},
    ['U'] = {0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00,0x00},
    ['V'] = {0xC6,0xC6,0xC6,0xC6,0x6C,0x38,0x00,0x00},
    ['W'] = {0xC6,0xC6,0xD6,0xFE,0xEE,0xC6,0x00,0x00},
    ['X'] = {0xC6,0x6C,0x38,0x38,0x6C,0xC6,0x00,0x00},
    ['Y'] = {0xC6,0xC6,0x6C,0x38,0x38,0x38,0x00,0x00},
    ['Z'] = {0xFE,0x0C,0x18,0x30,0x60,0xFE,0x00,0x00},

    ['.'] = {0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00},
    [','] = {0x00,0x00,0x00,0x00,0x18,0x18,0x30,0x00},
    [':'] = {0x00,0x18,0x18,0x00,0x18,0x18,0x00,0x00},
    [';'] = {0x00,0x18,0x18,0x00,0x18,0x18,0x30,0x00},
    ['!'] = {0x18,0x18,0x18,0x18,0x00,0x18,0x00,0x00},
    ['?'] = {0x7C,0xC6,0x0C,0x18,0x18,0x00,0x18,0x00},
    ['@'] = {0x7C,0xC6,0xDE,0xDE,0xC0,0x7C,0x00,0x00},
    ['#'] = {0x36,0x36,0x7F,0x36,0x7F,0x36,0x36,0x00},
    ['$'] = {0x18,0x3E,0x60,0x3C,0x06,0x7C,0x18,0x00},
    ['%'] = {0x62,0x64,0x08,0x10,0x26,0x46,0x00,0x00},
    ['^'] = {0x10,0x28,0x44,0x00,0x00,0x00,0x00,0x00},
    ['&'] = {0x30,0x48,0x30,0x4A,0x44,0x3A,0x00,0x00},
    ['*'] = {0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00},
    ['('] = {0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00},
    [')'] = {0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00},
    ['['] = {0x1C,0x18,0x18,0x18,0x18,0x18,0x1C,0x00},
    [']'] = {0x38,0x18,0x18,0x18,0x18,0x18,0x38,0x00},
    ['{'] = {0x0E,0x0C,0x0C,0x38,0x0C,0x0C,0x0E,0x00},
    ['}'] = {0x38,0x18,0x18,0x0E,0x18,0x18,0x38,0x00},
    ['<'] = {0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x00},
    ['>'] = {0x30,0x18,0x0C,0x06,0x0C,0x18,0x30,0x00},
    ['/'] = {0x06,0x0C,0x18,0x30,0x60,0xC0,0x80,0x00},
    ['\\'] = {0xC0,0x60,0x30,0x18,0x0C,0x06,0x02,0x00},
    ['|'] = {0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00},
    ['-'] = {0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00},
    ['_'] = {0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00},
    ['+'] = {0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00},
    ['='] = {0x00,0x7E,0x00,0x7E,0x00,0x00,0x00,0x00},
    ['\'']= {0x18,0x18,0x30,0x00,0x00,0x00,0x00,0x00},
    ['"'] = {0x6C,0x6C,0x48,0x00,0x00,0x00,0x00,0x00},
    ['`'] = {0x30,0x18,0x00,0x00,0x00,0x00,0x00,0x00},
    ['~'] = {0x32,0x4C,0x00,0x00,0x00,0x00,0x00,0x00},
    [' '] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};